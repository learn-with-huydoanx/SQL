# I. Index l√† g√¨ ?

`Index` l√† m·ªôt c∆° ch·∫ø t·ªëi ∆∞u h√≥a d√πng ƒë·ªÉ c·∫£i thi·ªán hi·ªáu su·∫•t üêé truy v·∫•n trong c·ªü s·ªü d·ªØ li·ªáu. Index gi√∫p tƒÉng t·ªëc ƒë·ªô üêé
truy v·∫•n b·∫±ng c√°ch t·∫°o ra m·ªôt c·∫•u tr√∫c d·ªØ li·ªáu b·ªï sung d√πng ƒë·ªÉ ƒë·ªãnh v·ªã v√† truy c·∫≠p nhanh nh·∫•t v√†o d·ªØ li·ªáu trong c√°c b·∫£ng
Database.

V√≠ d·ª•: Ch√∫ng ta c√≥ m·ªôt b·∫£ng `student(id, name, score)` l∆∞u th√¥ng tin sinh vi√™n, ta mu·ªën l·∫•y ra th√¥ng tin c√°c sinh vi√™n
theo kho·∫£ng ƒëi·ªÉm th√¨ s·∫Ω truy v·∫•n SQL nh∆∞ sau:

```sql
SELECT *
FROM student
WHERE score > 8;
```

V·∫•n ƒë·ªÅ: Truy v·∫•n s·∫Ω ph·∫£i qu√©t to√†n b·ªô b·∫£ng `student` ƒë√≥ ƒë·ªÉ so s√°nh v√† l·∫•y ra nh·ªØng b·∫£n ghi th·ªèa m√£n. C≈©ng gi·ªëng nh∆∞ vi·ªác
l·∫∑p m·ªôt List Student v√† ki·ªÉm tra score > s·ªë ƒëi·ªÉm c·∫ßn t√¨m v·∫≠y. V√¨ v·∫≠y khi s·ªë l∆∞·ª£ng sinh vi√™n l√™n ƒë·∫øn h√†ng tri·ªáu hay th·∫≠m
ch√≠ l√† nhi·ªÅu h∆°n üò± th√¨ vi·ªác n√†y s·∫Ω tr·ªü n√™n r·∫•t r·∫•t ch·∫≠m v√† t·ªën nhi·ªÅu chi ph√≠ ü§ï.

T√°c d·ª•ng c·ªßa Index: Index s·∫Ω gi√∫p gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ tr√™n b·∫±ng vi·ªác ƒë·ªãnh v·ªã c√°c d√≤ng d·ªØ li·ªáu th·ªèa m√£n ƒëi·ªÅu ki·ªán b·∫±ng c√°ch
tr·ªè t·ªõi ƒë·ªãa ch·ªâ c·ªßa d·ªØ li·ªáu t∆∞∆°ng ·ª©ng v·ªõi ƒëi·ªÅu ki·ªán ƒë√≥ ü•±. N√≥ t∆∞∆°ng t·ª± nh∆∞ vi·ªác ch√∫ng ta ƒë√°nh s·ªë trang cho m·ªôt quy·ªÉn
s√°ch v·∫≠y, ch√∫ng ta ch·ªâ c·∫ßn l·∫≠t ƒë·∫øn s·ªë trang c√≥ n·ªôi dung c·∫ßn lu√¥n m√† kh√¥ng c·∫ßn ph·∫£i l·∫≠t t·ª´ng trang m·ªôt cho ƒë·∫øn khi t√¨m
ƒë·∫øn n·ªôi dung ƒë√≥.

# II. ∆Øu nh∆∞·ª£c ƒëi·ªÉm c·ªßa Index

### ∆Øu ƒëi·ªÉm

- M·ªôt Index cho ph√©p ch∆∞∆°ng tr√¨nh t√¨m d·ªØ li·ªáu trong b·∫£ng m√† kh√¥ng c·∫ßn qu√©t to√†n b·ªô b·∫£ng.
- Index gi√∫p l√†m tƒÉng t·ªëc ƒë·ªô th·ª±c thi c√°c truy v·∫•n c·∫ßn n·ªëi nhi·ªÅu b·∫£ng hay c·∫ßn s·∫Øp x·∫øp d·ªØ li·ªáu.
- M·ªôt Index h·ª£p l√Ω c√≥ th·ªÉ c·∫£i thi·ªán s·ª± th·ª±c thi c∆° s·ªü d·ªØ li·ªáu b·ªüi gi·∫£m b·ªõt th·ªùi gian truy c·∫≠p.

### Nh∆∞·ª£c ƒëi·ªÉm

- C√°c b·∫£ng c√≥ c√°c Index ƒë√≤i h·ªèi nhi·ªÅu dung l∆∞·ª£ng b·ªô nh·ªõ h∆°n trong Database.
- C√°c l·ªánh thao t√°c d·ªØ li·ªáu ƒë√≤i h·ªèi nhi·ªÅu th·ªùi gian x·ª≠ l√Ω h∆°n, v√¨ ch√∫ng c·∫ßn c·∫≠p nh·∫≠t s·ª± thay ƒë·ªïi t·ªõi c√°c Index. ƒêi·ªÅu n√†y
  s·∫Ω d·∫´n ƒë·∫øn vi·ªác th√™m (_c√≥ th·ªÉ bao g·ªìm s·ª≠a v√† x√≥a_) b·∫£n ghi tr·ªü n√™n ch·∫≠m h∆°n

# III. C·∫•u tr√∫c v√† c√°ch ho·∫°t ƒë·ªông c·ªßa Index

T√πy theo Database m√† c·∫•u tr√∫c Index c·ªßa n√≥ s·∫Ω kh√°c nhau, nh∆∞ng th∆∞·ªùng th√¨ s·∫Ω gi·ªëng nhau ho·∫∑c c≈©ng kh√¥ng c√≥ s·ª± kh√°c bi·ªát
qu√° l·ªõn. ·ªû b√†i vi·∫øt n√†y ch√∫ng ta s·∫Ω n√≥i v·ªÅ MySQL th√¥i nha =)). MySQL cung c·∫•p 3 c·∫•u tr√∫c kh√°c nhau bao g·ªìm: B-Tree, Hash
v√† R-Tree index.

- R-Tree index ƒë∆∞·ª£c s·ª≠ d·ª•ng cho c√°c lo·∫°i d·ªØ li·ªáu h√¨nh h·ªçc kh√¥ng gian Spatial data.
- Vi·ªác l·ª±a tr·ªçn c·∫•u tr√∫c Index c√≤n ph·ª• thu·ªôc v√†o Storage Engine. Th∆∞·ªùng th√¨ khi s·ª≠ d·ª•ng MySQL ch√∫ng ta s·∫Ω d√πng InnoDB m√†
  n√≥ ch·ªâ h·ªó tr·ª£ B-Tree

=> N√™n m√¨nh ch·ªâ t√¨m hi·ªÉu B-Tree th√¥i nh√© üòÅ

Chi ti·∫øt v·ªÅ m·∫•y c√°i n√†y th√¨ m·ªçi ng∆∞·ªùi t·ª± t√¨m hi·ªÉu th√™m nha üòÅ t·∫°i v√¨ n√≥ thu·ªôc v·ªÅ ph·∫ßn c·∫•u tr√∫c d·ªØ li·ªáu r·ªìi ü•π

### B-Tree

![btree.png](img/btree.png)

- D·ªØ li·ªáu index ƒë∆∞·ª£c t·ªï ch·ª©c v√† l∆∞u tr·ªØ theo d·∫°ng tree, t·ª©c l√† c√≥ root, branch, leaf.
- Hi·ªÉu m·ªôt c√°ch ƒë∆°n gi·∫£n th√¨ B-Tree l√† m·ªôt ki·ªÉu c·∫•u tr√∫c d·ªØ li·ªáu tree g·ªìm c√°c node, gi√° tr·ªã c·ªßa c√°c node ƒë∆∞·ª£c t·ªï ch·ª©c
  tƒÉng d·∫ßn t·ª´ tr√°i qua ph·∫£i, m·ªói node ch·ª©a 2 th·ª© l√†: `Index Key` v√† `Disk Address` t∆∞∆°ng ·ª©ng c·ªßa n√≥.
- Khi truy v·∫•n d·ªØ li·ªáu th√¨ Database s·∫Ω kh√¥ng scan d·ªØ li·ªáu tr√™n to√†n b·ªô b·∫£ng ƒë·ªÉ t√¨m d·ªØ li·ªáu, vi·ªác t√¨m ki·∫øm trong B-Tree
  l√† 1 qu√° tr√¨nh ƒë·ªá quy, b·∫Øt ƒë·∫ßu t·ª´ root node v√† t√¨m ki·∫øm t·ªõi branch v√† leaf, ƒë·∫øn khi t√¨m ƒë∆∞·ª£c t·∫•t c·∫£ d·ªØ li·ªáu ‚Äì th·ªèa m√£n
  v·ªõi ƒëi·ªÅu ki·ªán truy v·∫•n th√¨ m·ªõi d√πng l·∫°i.
- B-Tree index ƒë∆∞·ª£c s·ª≠ d·ª•ng trong c√°c bi·ªÉu th·ª©c so s√°nh d·∫°ng: =, >, >=, <, <=, BETWEEN v√† LIKE. ‚áí C√≥ th·ªÉ t·ªëi ∆∞u t·ªët cho
  c√¢u l·ªánh ORDER BY.

### C√°ch CSDL bi·∫øt nh·ªØng tr∆∞·ªùng kh√°c trong b·∫£ng s·∫Ω tr·∫£ v·ªÅ

Index ch·ªâ l∆∞u tr·ªØ c√°c gi√° tr·ªã v√† con tr·ªè, v·∫≠y l√†m nh∆∞ th·∫ø n√†o m√† khi truy v·∫•n ch√∫ng ta v·∫´n c√≥ c√°c tr∆∞·ªùng d·ªØ li·ªáu kh√°c
c·ªßa h√†ng t∆∞∆°ng ·ª©ng ƒë√≥?

C√°c Index Database s·∫Ω l∆∞u tr·ªØ c√°c con tr·ªè ƒë∆°n gi·∫£n l√† th√¥ng tin tham chi·∫øu v·ªÅ v·ªã tr√≠ c·ªßa th√¥ng tin b·ªï sung trong b·ªô nh·ªõ.
V·ªÅ c∆° b·∫£n, index ch·ª©a score ƒë·ªãa ch·ªâ c·ªßa sinh vi√™n c·ª• th·ªÉ ƒë√≥ tr√™n ƒëƒ©a b·ªô nh·ªõ. Index th·ª±c s·ª± s·∫Ω tr√¥ng nh∆∞ th·∫ø n√†y:
![indexed-table.png](img/indexed-table.png)

V·ªõi Index ·ªü tr√™n, truy v·∫•n ch·ªâ c√≥ th·ªÉ t√¨m ki·∫øm c√°c h√†ng trong `score` c·ªôt c√≥ gi√° tr·ªã = `9` v√† sau ƒë√≥ s·ª≠ d·ª•ng con tr·ªè c·ªßa
n√≥ ƒë·ªÉ ƒëi v√†o b·∫£ng ƒë·ªÉ t√¨m h√†ng c·ª• th·ªÉ n∆°i con tr·ªè ƒë√≥ t·ªìn t·∫°i. Sau ƒë√≥, truy v·∫•n c√≥ th·ªÉ ƒëi v√†o b·∫£ng ƒë·ªÉ truy xu·∫•t c√°c tr∆∞·ªùng
theo c√°c c·ªôt ƒë∆∞·ª£c y√™u c·∫ßu cho h√†ng ƒë√°p ·ª©ng c√°c ƒëi·ªÅu ki·ªán.

### T√≥m t·∫Øt

- Index l√† m·ªôt c·∫•u tr√∫c d·ªØ li·ªáu bao g·ªìm c√°c c·ªôt cho c√°c ƒëi·ªÅu ki·ªán t√¨m ki·∫øm v√† m·ªôt con tr·ªè. Con tr·ªè n√†y l√† ƒë·ªãa ch·ªâ tr√™n
  ƒëƒ©a nh·ªõ c·ªßa h√†ng d·ªØ li·ªáu c√≤n l·∫°i.
- C·∫•u tr√∫c d·ªØ li·ªáu Index ƒë∆∞·ª£c s·∫Øp x·∫øp ƒë·ªÉ t·ªëi ∆∞u h√≥a hi·ªáu su·∫•t truy v·∫•n.
- Truy v·∫•n t√¨m ki·∫øm m·ªôt h√†ng c·ª• th·ªÉ trong Index. Index tr·ªè ƒë·∫øn con tr·ªè, t·ª´ ƒë√≥ t√¨m th·∫•y th√¥ng tin c√≤n l·∫°i.
- Ch·ªâ m·ª•c gi·∫£m s·ªë l∆∞·ª£ng h√†ng m√† truy v·∫•n ph·∫£i t√¨m ki·∫øm t·ª´ 5 xu·ªëng c√≤n 2.

# IV. Ph√¢n lo·∫°i Index

### Clustered Index

- Clustered Index l√† ch·ªâ m·ª•c duy nh·∫•t tr√™n m·ªói b·∫£ng s·ª≠ d·ª•ng kh√≥a ch√≠nh ƒë·ªÉ t·ªï ch·ª©c d·ªØ li·ªáu trong b·∫£ng. N√≥ ƒë·∫£m b·∫£o r·∫±ng
  kh√≥a ch√≠nh ƒë∆∞·ª£c l∆∞u tr·ªØ theo th·ª© t·ª± tƒÉng d·∫ßn, ƒë√≥ c≈©ng l√† th·ª© t·ª± m√† b·∫£ng gi·ªØ trong b·ªô nh·ªõ.

### Non-Clustered Index

- Non-Clustered Index l√† c√°c tham chi·∫øu ƒë∆∞·ª£c s·∫Øp x·∫øp cho m·ªôt tr∆∞·ªùng c·ª• th·ªÉ t·ª´ b·∫£ng ch√≠nh v√† n√≥ ch·ª©a c√°c con tr·ªè ch·ªâ v·ªÅ
  m·ª•c g·ªëc ·ªü b·∫£ng ch√≠nh. V√≠ d·ª• ·ªü tr√™n l√† m·ªôt ch·ªâ m·ª•c kh√¥ng ph√¢n c·ª•m.

### So s√°nh:

![index-clustered.png](img/index-clustered.png)

# V. Demo

L√Ω thuy·∫øt nhi√™u ƒë√≥ l√† ƒë·ªß r·ªìi üòÇ. B√¢y gi·ªù m√¨nh s·∫Ω ƒëi v√†o demo üòÅ

T·∫°o table v√† d·ªØ li·ªáu test

```sql
CREATE TABLE `student`
(
    `id`    int NOT NULL AUTO_INCREMENT,
    `name`  varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
    `score` int                                                     DEFAULT NULL,
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;
```

```sql
CREATE PROCEDURE create_data()
BEGIN
  DECLARE
i INT DEFAULT 100;

  WHILE
i < 100000 DO
    INSERT INTO student (name, score) VALUES (CONCAT("Test-", i), FLOOR(RAND() * 10) + 1);
    SET
i = i + 1;
END WHILE;
END

CALL create_data();
```

## 1. Single Column Index

T·∫°o Index

```sql
CREATE INDEX idx_score ON student (score) USING BTREE;
```

X√≥a Index

```sql
DROP INDEX idx_score ON student;
```

**Sau khi t·∫°o d·ªØ li·ªáu ch√∫ng ta s·∫Ω ki·ªÉm tra chi·∫øn l∆∞·ª£c th·ª±c thi c·ªßa c√¢u SQL**

### V√≠ d·ª• 1: Index l√† tr∆∞·ªùng Score

```sql
EXPLAIN
ANALYZE
SELECT *
FROM student
WHERE score = 8;
```

N·∫øu ch∆∞a c√≥ Index th√¨ khi ch·∫°y l·ªánh tr√™n k·∫øt qu·∫£ s·∫Ω tr·∫£ v·ªÅ l√†:

`-> Filter: (s.score = 8)  (cost=10128.83 rows=10013) (actual time=3.007..66.145 rows=10165 loops=1)
-> Table scan on s  (cost=10128.83 rows=100125) (actual time=2.999..58.222 rows=99900 loops=1)
`

- `Filter`:
    - `(s.score > 8)`: ƒê√¢y l√† ph·∫ßn filter (b·ªô l·ªçc) c·ªßa truy v·∫•n. N√≥ ch·ªâ ra r·∫±ng truy v·∫•n n√†y s·ª≠ d·ª•ng m·ªôt ƒëi·ªÅu ki·ªán ƒë·ªÉ
      l·ªçc ra c√°c b·∫£n ghi trong b·∫£ng student v·ªõi ƒëi·ªÅu ki·ªán score l·ªõn h∆°n 8.
    - `(cost=10084.75 rows=33372)`: ∆Ø·ªõc t√≠nh chi ph√≠ l√† 10084.75 v√† s·ªë h√†ng ∆∞·ªõc t√≠nh s·∫Ω ƒë∆∞·ª£c tr·∫£ v·ªÅ sau khi √°p d·ª•ng b·ªô
      l·ªçc l√† 33372.
    - `(actual time=0.048..35.858 rows=19805 loops=1)`: Th·ªùi gian th·ª±c t·∫ø m√† truy v·∫•n m·∫•t ƒë·ªÉ th·ª±c hi·ªán. ·ªû ƒë√¢y, th·ªùi gian
      b·∫Øt ƒë·∫ßu (0.048) v√† th·ªùi gian k·∫øt th√∫c (35.858) c·ªßa truy v·∫•n ƒë∆∞·ª£c hi·ªÉn th·ªã. S·ªë h√†ng th·ª±c t·∫ø ƒë∆∞·ª£c tr·∫£ v·ªÅ sau khi
      th·ª±c hi·ªán truy v·∫•n l√† 19805. S·ªë l·∫ßn l·∫∑p (loops) l√† 1, c√≥ nghƒ©a r·∫±ng truy v·∫•n ch·ªâ ƒë∆∞·ª£c th·ª±c hi·ªán m·ªôt l·∫ßn.
- `Table scan on s`:  Ph·∫ßn c·ªßa k·∫ø ho·∫°ch truy v·∫•n th·ª±c t·∫ø, cho bi·∫øt r·∫±ng truy v·∫•n ƒë√£ qu√©t to√†n b·ªô b·∫£ng `student` ƒë·ªÉ t√¨m
  c√°c h√†ng th·ªèa m√£n ƒëi·ªÅu ki·ªán.

Khi th√™m Index v√†o c·ªôt score th√¨ k·∫øt qu·∫£ tr·∫£ v·ªÅ l√†:
`-> Index lookup on s using idx_score (score=8)  (cost=1233.25 rows=10165) (actual time=0.364..19.901 rows=10165 loops=1)
`

Ta c√≥ th·ªÉ th·∫•y chi ph√≠ v√† th·ªùi gian th·ª±c hi·ªán ƒë√£ gi·∫£m ƒëi r·∫•t nhi·ªÅu sau khi s·ª≠ d·ª•ng Index.

Tuy nhi√™n h√£y th·ª≠ v·ªõi c√¢u truy v·∫•n n√†y:

```sql
EXPLAIN
ANALYZE
SELECT *
FROM student
WHERE score > 6;
```

Th√¨ k·∫øt qu·∫£ tr·∫£ v·ªÅ l·∫°i l√†:
`-> Filter: (student.score > 6) (cost=10235.37 rows=50062) (actual time=0.767..62.192 rows=40016 loops=1)
-> Table scan on student  (cost=10235.37 rows=100125) (actual time=0.760..55.178 rows=99900 loops=1)
`

V·ªõi k·∫øt qu·∫£ tr√™n th√¨ r√µ r√†ng l√† n√≥ ƒëang qu√©t to√†n b·ªô b·∫£ng v√† kh√¥ng s·ª≠ d·ª•ng Index. T·∫°i sao?

ƒêi·ªÅu n√†y l√† do tr√¨nh t·ªëi ∆∞u c·ªßa MySQL s·∫Ω t·ª± ƒë·ªông l·ª±a ch·ªçn chi·∫øn l∆∞·ª£c th·ª±c thi t·ªët nh·∫•t. MySQL ph√¢n t√≠ch v√† cho r·∫±ng vi·ªác
th·ª±c hi·ªán qu√©t ch·ªâ m·ª•c s·∫Ω kh√¥ng hi·ªáu qu·∫£ b·∫±ng vi·ªác qu√©t to√†n b·ªô b·∫£ng.

=> N·∫øu c√≥ nhi·ªÅu h√†ng c√≥ `score > 6` th√¨ vi·ªác s·ª≠ d·ª•ng Index th·ª±c s·ª± c√≥ th·ªÉ k√©m hi·ªáu qu·∫£ h∆°n. V√≠ d·ª•: n·∫øu 90% b·∫£n ghi
c√≥ `score > 6` th√¨ tr√¨nh t·ªëi ∆∞u h√≥a truy v·∫•n s·∫Ω ph·∫£i qu√©t kho·∫£ng 90% n√∫t l√° c·ªßa Index v√† sau ƒë√≥ ƒë·ªçc √≠t nh·∫•t 90% c·ªßa b·∫£ng
ƒë·ªÉ l·∫•y d·ªØ li·ªáu th·ª±c t·∫ø, ƒëi·ªÅu n√†y s·∫Ω ƒë√≤i h·ªèi ƒë·ªçc nhi·ªÅu d·ªØ li·ªáu t·ª´ ƒëƒ©a h∆°n l√† ch·ªâ vi·ªác qu√©t b·∫£ng.

ƒê·ªÉ ki·ªÉm ch·ª©ng ƒëi·ªÅu n√†y m·ªçi ng∆∞·ªùi c√≥ th·ªÉ th·ª≠ v·ªõi c√¢u truy v·∫•n sau (Hint Index s·ª≠ d·ª•ng FORCE INDEX ho·∫∑c USE INDEX) ƒë·ªÉ b·∫Øt
bu·ªôc MySQL s·ª≠ d·ª•ng Index:

```sql
EXPLAIN
ANALYZE
SELECT *
FROM student FORCE INDEX (idx_score)
WHERE score > 6;
```

K·∫øt qu·∫£ s·∫Ω
l√†: `-> Index range scan on student using idx_score, with index condition: (student.score > 6)  (cost=37604.09 rows=49980) (actual time=2.178..164.649 rows=39958 loops=1)`

Ch√∫ng ta c√≥ th·ªÉ th·∫•y chi ph√≠ ƒë·ªÉ th·ª±c hi·ªán khi s·ª≠ d·ª•ng Index l√† r·∫•t cao => MySQL s·∫Ω t·ª± ƒë·ªông l·ª±a ch·ªçn chi·∫øn l∆∞·ª£c t·ªëi ∆∞u
nh·∫•t (th∆∞·ªùng th√¨ n·∫øu d·ªØ li·ªáu > 20%, 30% th√¨ MySQL s·∫Ω ∆∞u ti√™n qu√©t full b·∫£ng).

### V√≠ d·ª• 2: Index l√† tr∆∞·ªùng Name

```sql
EXPLAIN
ANALYZE
SELECT *
FROM student
WHERE name LIKE '%Test-123%';
```

K·∫øt qu·∫£ khi c√≥
Index: `-> Filter: (student.name like '%Test-123%')  (cost=10084.75 rows=11124) (actual time=0.127..56.273 rows=111 loops=1)
-> Table scan on student  (cost=10084.75 rows=100125) (actual time=0.068..31.552 rows=99900 loops=1)
`. V·∫´n l√† qu√©t full b·∫£ng ƒëi·ªÅu n√†y l√† do ph·∫ßn keyword ƒëi·ªÅu ki·ªán c√≥ k√Ω t·ª± % ·ªü tr∆∞·ªõc. ƒêi·ªÅu n√†y gi·ªëng nh∆∞ vi·ªác tra c·ª©u m√†
kh√¥ng bi·∫øt t·ª´ kh√≥a b·∫Øt ƒë·∫ßu b·∫±ng ch·ªØ c√°i n√†o th√¨ s·∫Ω kh√¥ng tra ƒë∆∞·ª£c.

```sql
EXPLAIN
ANALYZE
SELECT *
FROM student
WHERE name LIKE 'Test-123%';
```

K·∫øt qu·∫£ khi c√≥
Index: `-> Index range scan on student using idx_name, with index condition: (student. name like 'Test-123%')  (cost=50.21 rows=111) (actual time=0.173..0.196 rows=111 loops=1)
`

```sql
EXPLAIN
ANALYZE
SELECT *
FROM student
WHERE name LIKE 'Test%';
```

K·∫øt qu·∫£ khi c√≥
Index: `-> Filter: (student. name like 'Test%')  (cost=10084.75 rows=50062) (actual time=0.034..43.723 rows=99900 loops=1)
-> Table scan on student  (cost=10084.75 rows=100125) (actual time=0.031..30.711 rows=99900 loops=1)
`. T·∫°i sao l·∫°i v·∫´n qu√©t full b·∫£ng? M·ªçi ng∆∞·ªùi suy nghƒ© v√† t·ª± tr·∫£ l·ªùi c√°i n√†y xem nha üòÅ.

```sql
EXPLAIN
ANALYZE
SELECT *
FROM student
WHERE UPPER(name) = 'Test-11745';
```

K·∫øt qu·∫£ khi c√≥
Index: `-> Filter: (upper(student.name) = 'TEST-11745')  (cost=10280.70 rows=99917) (actual time=13.546..65.849 rows=1 loops=1)
-> Table scan on student  (cost=10280.70 rows=99917) (actual time=2.508..46.208 rows=99900 loops=1)
`. Tr∆∞·ªùng h·ª£p n√†y v·∫´n s·∫Ω qu√©t full b·∫£ng do ch√∫ng ta d√πng h√†m SQL, v√† gi√° tr·ªã s·∫Ω kh√¥ng kh·ªõp v·ªõi Index n√™n s·∫Ω kh√¥ng nh·∫≠n
ƒë∆∞·ª£c.

- ƒê·ªÉ gi·∫£i quy·∫øt th√¨ m√¨nh c√≥ th·ªÉ x·ª≠ l√Ω ·ªü code ƒë·ªÉ upper l√™n tr∆∞·ªõc.
- Ho·∫∑c t·∫°o Function-Based Index upper name

```sql
ALTER TABLE student
    ADD INDEX functional_idx_upper_name((UPPER(name)));
```

=> Kh√¥ng ph·∫£i khi n√†o s·ª≠ d·ª•ng Index c≈©ng nh·∫≠n. V√≠ d·ª• nh∆∞ `%` ·ªü tr√™n, ho·∫∑c s·ª≠ d·ª•ng m·ªôt s·ªë h√†m c·ªßa SQL s·∫Ω kh√¥ng nh·∫≠n
Index. ƒê·ªÉ bi·∫øt h·∫øt m·∫•y c√°i n√†y th√¨ ph·∫£i t√≠ch l≈©y theo th·ªùi gian v√† kinh nghi·ªám n·ª≠a :v

## 2. Composite Index/Multi Column Index

Trong th·ª±c t·∫ø kh√¥ng ph·∫£i khi n√†o ch√∫ng ta c≈©ng s·∫Ω s·ª≠ d·ª•ng Index tr√™n m·ªôt c·ªôt m√† c√≥ th·ªÉ s·∫Ω l√† nhi·ªÅu c·ªôt m·ªôt l√∫c ƒë·ªÉ t·ªëi ∆∞u
c√¢u truy v·∫•n v·ªõi nhi·ªÅu ƒëi·ªÅu ki·ªán ·ªü nhi·ªÅu tr∆∞·ªùng kh√°c nhau

T·∫°o Index

```sql
CREATE INDEX idx_score_name ON student (score, `name`) USING BTREE;
```

Xem Index trong b·∫£ng

```sql
SHOW
INDEX FROM student;
```

- Tuy nhi√™n khi s·ª≠ d√πng Index v·ªõi nhi·ªÅu c·ªôt m√† ch√∫ng ta ch·ªâ WHERE ch·ªâ v·ªõi m·ªôt c·ªôt trong Index ƒë√≥ th√¨ th·ª© t·ª± ƒë∆∞·ª£c t·∫°o
  c≈©ng s·∫Ω ·∫£nh h∆∞·ªüng ƒë·∫øn chi·∫øn l∆∞·ª£c th·ª±c thi

V√≠ d·ª•:

```sql
EXPLAIN
ANALYZE
SELECT *
FROM student
WHERE name = 'TEST-11745';
```

Ch√∫ng ta c√≥ th·ªÉ ki·ªÉm tra v·ªõi c√¢u truy v·∫•n tr√™n v·ªõi Index sau:

```sql
CREATE INDEX idx_score_name ON student (score, `name`) USING BTREE;
```

K·∫øt qu·∫£ s·∫Ω l√†: `-> Filter: (student.name = 'TEST-11745')  (cost=3016.75 rows=9996) (actual time=2.333..2.339 rows=1 loops=1)
-> Index range scan on student using index_for_skip_scan(idx_score_name)  (cost=3016.75 rows=9996) (actual time=2.331..2.336 rows=1 loops=1)
`

V√† v·ªõi Index sau:

```sql
CREATE INDEX idx_name_score ON student (`name`, score) USING BTREE;
```

K·∫øt qu·∫£ s·∫Ω
l√†: `-> Index lookup on student using idx_name_score (name='TEST-11745')  (cost=1.10 rows=1) (actual time=0.026..0.026 rows=0 loops=1)
`

T·ª´ 2 k·∫øt qu·∫£ tr√™n ch√∫ng ta c√≥ th·ªÉ th·∫•y, th·ª© t·ª± c√°c c·ªôt khi t·∫°o Index s·∫Ω ·∫£nh h∆∞·ªüng ƒë·∫øn chi·∫øn l∆∞·ª£c th·ª±c thi c·ªßa c√¢u truy
v·∫•n, chi ph√≠ gi·∫£m ƒëi g·∫ßn 3000 l·∫ßn v√† th·ªùi gian c≈©ng gi·∫£m ƒëi ƒë√°ng k·ªÉ :v

Khi t·∫°o Index v·ªõi `name` ·ªü ƒë·∫ßu n√≥ s·∫Ω s·ª≠ d·ª•ng gi·∫£i thu·∫≠t Index lookup, c√≤n v·ªõi `name` ·ªü sau n√≥ s·ª≠ d·ª•ng gi·∫£i thu·∫≠t Index
range scan v√† Index skip scan ƒë·ªÉ b·ªè qua c√°c c·ªôt trong Index.

## T√≥m t·∫Øt:

- Khi th·ª±c hi·ªán chi·∫øn l∆∞·ª£c th·ª±c thi s·∫Ω c√≥ c√°c gi·∫£i thu·∫≠t ph·ªï bi·∫øn sau:
    - Table scan on ...: Qu√©t to√†n b·ªô b·∫£ng ƒë·ªÉ t√¨m ra c√°c h√†ng th·ªèa m√£n ƒëi·ªÅu ki·ªán
    - Index scan on ...: Qu√©t to√†n b·ªô Index
    - Index lookup: S·ª≠ d·ª•ng Index truy c·∫≠p d·ªØ li·ªáu b·∫±ng m·ªôt gi√° tr·ªã duy nh·∫•t, truy v·∫•n tr·ª±c ti·∫øp h√†ng ch·ª©a gi√° tr·ªã c·∫ßn
      t√¨m. N√≥ ƒë∆∞·ª£c s·ª≠ d·ª•ng cho bi·ªÉu th·ª©c ƒëi·ªÅu ki·ªán `=`
    - Index range scan: S·ª≠ d·ª•ng Index truy c·∫≠p d·ªØ li·ªáu v·ªõi m·ªôt ph·∫°m vi ho·∫∑c kho·∫£ng gi√° tr·ªã Index kh·ªõp v·ªõi ƒëi·ªÅu ki·ªán truy
      v·∫•n. N√≥ ƒë∆∞·ª£c s·ª≠ d·ª•ng cho c√°c bi·ªÉu th·ª©c ƒëi·ªÅu ki·ªán l√† `>, >=, <, <=, LIKE, BETWEEN`
    - Index skip scan: S·ª≠ d·ª•ng Composite Index truy c·∫≠p d·ªØ li·ªáu kh√¥ng ph·∫£i c·ªôt ƒë·∫ßu ti√™n c·ªßa Composite Index.
    - ...
- Khi k·∫øt qu·∫£ truy v·∫•n tr·∫£ v·ªÅ > 20%, 30% s·ªë l∆∞·ª£ng b·∫£n ghi c·ªßa b·∫£ng th√¨ Database s·∫Ω ∆∞u ti√™n qu√©t to√†n b·ªô b·∫£ng.
- S·ª≠ d·ª•ng Index c·∫ßn tr√°nh c√°c tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng m·ªôt s·ªë h√†m SQL ho·∫∑c m·ªôt s·ªë tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát kh√°c s·∫Ω kh√¥ng th·ª±c hi·ªán
  ƒë∆∞·ª£c Index.
- Khi t·∫°o Composite Index nh∆∞ng kh√¥ng t·∫°o ri√™ng Single Column Index v√† ƒëi·ªÅu ki·ªán truy v·∫•n ch·ªâ c√≥ m·ªôt c·ªôt th√¨ c·∫ßn ch√∫ √Ω
  ƒë·∫øn th·ª© t·ª± c·ªôt trong Composite Index v√¨ n√≥ s·∫Ω ·∫£nh h∆∞·ªüng t·ªõi k·∫øt qu·∫£ c·ªßa chi·∫øn l∆∞·ª£c th·ª±c thi.
- C√≥ th·ªÉ s·ª≠ d·ª•ng Hint Index ƒë·ªÉ y√™u c·∫ßu truy v·∫•n th·ª±c hi·ªán Index. Tuy nhi√™n c·∫ßn ph·∫£i ki·ªÉm so√°t ƒë∆∞·ª£c n√≥.

# VI. S·ª≠ d·ª•ng Index m·ªôt c√°ch hi·ªáu qu·∫£ ‚Ä¢ Kh√¥ng ph·∫£i Index n√†o c≈©ng nhanh

- N√™n t·∫°o Index tr√™n c√°c c·ªôt khi:
    - B·∫£ng ch·ª©a d·ªØ li·ªáu l·ªõn
    - C·ªôt ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t√¨m ki·∫øm th∆∞·ªùng xuy√™n
    - C·ªôt ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ s·∫Øp x·∫øp d·ªØ li·ªáu
    - D·ªØ li·ªáu trong c·ªôt c√≥ s·ª± ph√¢n bi·ªát cao
- Kh√¥ng n√™n t·∫°o Index tr√™n c√°c c·ªôt khi:
    - B·∫£ng ch·ªâ ch·ª©a m·ªôt v√†i h√†ng
    - C·ªôt th∆∞·ªùng xuy√™n c√≥ thao t√°c th√™m s·ª≠a x√≥a
    - C·ªôt c√≥ s·ª± tr√πng l·∫∑p d·ªØ li·ªáu cao
    